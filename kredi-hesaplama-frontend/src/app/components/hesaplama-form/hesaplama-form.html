<div class="hesaplama-container">
  <div class="form-card">
    <h2>Kredi Hesaplama Formu</h2>
    
    <form [formGroup]="hesaplamaForm" (ngSubmit)="hesapla()" class="hesaplama-form">
      <div class="form-group">
        <label for="krediTipi">Kredi TÃ¼rÃ¼:</label>
        <select id="krediTipi" formControlName="krediTipi" class="form-control">
          <option value="">Kredi tÃ¼rÃ¼ seÃ§iniz</option>
          <option *ngFor="let tur of krediTurleri" [value]="tur.value">
            {{ tur.ad }}
          </option>
        </select>
        <div *ngIf="hesaplamaForm.get('krediTipi')?.invalid && hesaplamaForm.get('krediTipi')?.touched" class="error-message">
          Kredi tÃ¼rÃ¼ seÃ§ilmelidir.
        </div>
      </div>

      <div class="form-group">
        <label for="tutar">Kredi TutarÄ± (TL):</label>
        <input 
          type="number" 
          id="tutar" 
          formControlName="tutar" 
          class="form-control"
          [min]="getTutarLimits().min"
          [max]="getTutarLimits().max"
          placeholder="Tutar giriniz">
        <div *ngIf="hesaplamaForm.get('tutar')?.invalid && hesaplamaForm.get('tutar')?.touched" class="error-message">
          GeÃ§erli bir tutar giriniz ({{ getTutarLimits().min | number }} - {{ getTutarLimits().max | number }} TL).
        </div>
      </div>

      <div class="form-group">
        <label for="vade">Vade (Ay):</label>
        <input 
          type="number" 
          id="vade" 
          formControlName="vade" 
          class="form-control"
          [min]="getVadeLimits().min"
          [max]="getVadeLimits().max"
          placeholder="Vade giriniz">
        <div *ngIf="hesaplamaForm.get('vade')?.invalid && hesaplamaForm.get('vade')?.touched" class="error-message">
          GeÃ§erli bir vade giriniz ({{ getVadeLimits().min }} - {{ getVadeLimits().max }} ay).
        </div>
      </div>

      <div class="form-group" *ngIf="faizOrani">
        <label>Faiz OranÄ± (%):</label>
        <div class="faiz-display">{{ faizOrani }}%</div>
      </div>

      <div class="form-actions">
        <button type="submit" [disabled]="hesaplamaForm.invalid || loading" class="btn-primary">
          <span *ngIf="loading">HesaplanÄ±yor...</span>
          <span *ngIf="!loading">Hesapla</span>
        </button>
        <button type="button" (click)="resetForm()" class="btn-secondary">Temizle</button>
      </div>
    </form>

    <div *ngIf="hata" class="error-alert">
      {{ hata }}
    </div>

    <div *ngIf="sonuc" class="sonuc-card">
      <h3>Hesaplama Sonucu</h3>
      <div class="sonuc-grid">
        <div class="sonuc-item">
          <span class="label">AylÄ±k Taksit:</span>
          <span class="value">{{ sonuc.aylikOdeme | number:'1.2-2' }} TL</span>
        </div>
        <div class="sonuc-item">
          <span class="label">Toplam Geri Ã–deme:</span>
          <span class="value">{{ sonuc.toplamOdeme | number:'1.2-2' }} TL</span>
        </div>
        <div class="sonuc-item">
          <span class="label">Toplam Faiz:</span>
          <span class="value">{{ (sonuc.toplamOdeme - sonuc.tutar) | number:'1.2-2' }} TL</span>
        </div>
        <div class="sonuc-item">
          <span class="label">Faiz OranÄ±:</span>
          <span class="value">{{ sonuc.faiz }}%</span>
        </div>
      </div>

      <div *ngIf="odemePlani.length > 0" class="odeme-plani">
        <h4>Ã–deme PlanÄ±</h4>
        <div class="table-container">
          <table class="odeme-table">
            <thead>
              <tr>
                <th>Taksit No</th>
                <th>Taksit TutarÄ±</th>
                <th>Ana Para</th>
                <th>Faiz</th>
                <th>Kalan Ana Para</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let taksit of odemePlani">
                <td>{{ taksit.Ay }}</td>
                <td>{{ taksit.Tutar | number:'1.2-2' }} TL</td>
                <td>{{ taksit.Anapara | number:'1.2-2' }} TL</td>
                <td>{{ taksit.Faiz | number:'1.2-2' }} TL</td>
                <td>{{ taksit.KalanAnaP | number:'1.2-2' }} TL</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- ğŸŒŸ Gemini YanÄ±tÄ± -->
    <div *ngIf="groqYanit" class="gemini-yanit">
      <p>{{ groqYanit }}</p>
    </div>


  </div>
</div>
